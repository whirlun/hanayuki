<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    {>"./layouts/master" /}
<body>
{<bodyContent}
<div class="user-top">
    {#userinfo}<img src="/img/avatar/{avatar}"/> <p class="lead">{nickname}</p>
</div>
<div class="user-info">
    <ul class="list-inline">
        <li>注册时间:{registertime}</li>
        <li>发帖数:{threadcount}</li>
        <li>回帖数:{replycount}</li>
        <li>等级:{role}</li>
        <li>邮箱:{email}</li>
    </ul>
<div class="user-detail">
<ul class="list-inline user-detail-btn" aria-label="userDetails">
    <a href="javascript:void(0)" hover-word="活动" onclick="activities(undefined)"><span>活动</span></button>
    <a href="javascript:void(0)" hover-word="通知" onclick="notifications()"><span>通知</span></button>
    <a href="javascript:void(0)" hover-word="私信" onclick="pms()"><span>私信</span></button>
    <a href="javascript:void(0)" hover-word="徽章" onclick="badges()"><span>徽章</span></button>
    <a href="javascript:void(0)" hover-word="设置" onclick="settings()"><span>设置</span></button>
</div>
<div class="user-detail">
    <ul id="user-menu" class="list-unstyled">
    </ul>
</div>
<div class="user-detail-data">
</div>
{/userinfo}
<script>
    var activities = function(nowpage) {
        var page;
        var csrf = "{csrf}";
        nowpage? page = nowpage : page = 1;
        var threads = window.localStorage.userinfo['threads'];
        var jsonData = {
            "threads":threads.slice((page-1)*7,page*7) ,
            "page": page,
            "_csrf": csrf 
        };
        var activity_menu = ['帖子', '回复', '赞过的', '收藏'];
        for (var i = 0;i < activity_menu.length;i++) {
            $("#user-menu").append('<li><a href="javascript:void(0)" hover-word="'+activity_menu[i]+'onclick="activities()">'+activity_menu[i]+"</li>");
        }
        {#userinfo}
        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            url: '/userhome/'+"{username}"+'/activities',
            data: JSON.stringify(jsonData),
            success: function(data) {var jsondata = JSON.parse(data);$("#user-detail-data").append("<ul id='thread-data'></ul>");
            for(var i = 0; i < jsondata.length; i++) {
                $("#thread-data").append("<li id='thread"+i+"'></li>").append("<p class='user-thread-title'>"+jsondata[i]['title']+"</p>");
                if(jsondata[i]['lock']) {
                    $("#thread"+i).append("<span class='glyphicons glyphicons-lock'></span>");
                }
                $("#thread"+i).append("<ul class='list-inline user-thread-status'><li><span class='glyphicons glyphicons-eye-open'></span>"+jsonData[i]['read']+"</li>"+
                "<li><span class='glyphicons glyphicons-comments'></span>"+jsonData[i]['rtotal']+"</li>");
                $("#thread"+i).append("<p class='thread-content'>"+jsondata[i]['content'].substr(0,100)+"</p>");
            }
            var pages = jsondata['page'];
            $("#user-detail-data").append("<a class='user-page-seperator' href='javacript:void(0)' onclick='activities(-1)' >上一页</a>");
            if(pages > 9) {
                for(var k = 0; k < 8; k++){
            $("#user-detail-data").append("<a class='user-page-seperator' href='javascript:void(0)' onclick='activities("+k+")'>"+k+"</a>");
                }
            $('#user-detail-data').append("<a class='user-page-seperator' href='javascript:void(0)' onclick='activities(0)'>下一页</a>");
            }
            else {
                for(var k = 0; k < pages; k++) {
            $("#user-detail-data").append("<a class='user-page-seperator' href='javascript:void(0)' onclick='activities(k)'>"+k+"</a>");                    
                }
            $('#user-detail-data').append("<a class='user-page-seperator' href='javascript:void(0)' onclick='activities(0)'>下一页</a>");
            }
            }
        })
    }
</script>
{/userinfo}
{/bodyContent}

</body>
</html>
